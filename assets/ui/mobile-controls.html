<!-- ========================================
  HYTOPIA SDK-COMPLIANT MOBILE CONTROLS
  Sports-City - Multiplayer Sports Hub

  Based on HYTOPIA_MOBILE_CONTROLS_GUIDE.md
======================================== -->

<div class="mobile-controls" id="mobile-controls">
  <div class="mobile-left-controls">
    <button id="mobile-sprint-btn" class="mobile-btn sprint-btn" aria-label="Sprint">
      <span class="btn-icon">&#x1F3C3;</span>
      <span class="btn-label">SPRINT</span>
    </button>
  </div>

  <div class="mobile-right-controls">
    <div class="mobile-btn-row top-row">
      <button id="mobile-emote-btn" class="mobile-btn emote-btn" aria-label="Emote">
        <span class="btn-icon">&#x1F60A;</span>
        <span class="btn-label">EMOTE</span>
      </button>
      <button id="mobile-chat-btn" class="mobile-btn chat-btn" aria-label="Chat">
        <span class="btn-icon">&#x1F4AC;</span>
        <span class="btn-label">CHAT</span>
      </button>
    </div>
    <div class="mobile-btn-row bottom-row">
      <button id="mobile-jump-btn" class="mobile-btn jump-btn" aria-label="Jump">
        <span class="btn-icon">&#x2B06;</span>
        <span class="btn-label">JUMP</span>
      </button>
      <button id="mobile-interact-btn" class="mobile-btn interact-btn primary-action" aria-label="Start Challenge">
        <span class="btn-icon">&#x1F3C6;</span>
        <span class="btn-label">START</span>
      </button>
    </div>
  </div>
</div>

<style>
  .mobile-controls { display: none; }

  body.mobile .mobile-controls,
  body.mobile.gameplay-active .mobile-controls {
    display: block;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 2000;
  }

  body.mobile .mobile-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 68px; height: 68px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.65);
    border: 3px solid rgba(255, 255, 255, 0.35);
    backdrop-filter: blur(8px);
    color: white;
    pointer-events: auto;
    touch-action: none;
    -webkit-touch-callout: none;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
    transition: transform 0.1s ease;
  }

  body.mobile .mobile-btn:active,
  body.mobile .mobile-btn.active {
    transform: scale(0.9);
    background: rgba(0, 0, 0, 0.85);
  }

  body.mobile .btn-icon { font-size: 22px; margin-bottom: 2px; }
  body.mobile .btn-label { font-size: 9px; font-weight: 700; }

  body.mobile .mobile-left-controls { position: fixed; left: 25px; bottom: 130px; }
  body.mobile .mobile-right-controls { position: fixed; right: 20px; bottom: 40px; }
  body.mobile .mobile-btn-row { display: flex; gap: 12px; justify-content: flex-end; margin-bottom: 12px; }
  body.mobile .mobile-btn.primary-action { width: 80px; height: 80px; }
  body.mobile .primary-action .btn-icon { font-size: 28px; }
  body.mobile .primary-action .btn-label { font-size: 10px; }

  /* Start Challenge - Gold/Trophy color */
  body.mobile .interact-btn {
    background: linear-gradient(145deg, rgba(255, 200, 50, 0.85), rgba(220, 160, 30, 0.9));
    border-color: rgba(255, 220, 100, 0.6);
  }
  body.mobile .interact-btn.active { box-shadow: 0 0 25px rgba(255, 200, 50, 0.6); }

  /* Jump - Blue */
  body.mobile .jump-btn {
    background: linear-gradient(145deg, rgba(50, 150, 220, 0.85), rgba(30, 120, 180, 0.9));
    border-color: rgba(100, 180, 255, 0.6);
  }

  /* Sprint - Orange/Energy */
  body.mobile .sprint-btn {
    background: linear-gradient(145deg, rgba(255, 140, 50, 0.85), rgba(220, 100, 30, 0.9));
    border-color: rgba(255, 180, 100, 0.6);
  }

  /* Emote - Purple/Fun */
  body.mobile .emote-btn {
    background: linear-gradient(145deg, rgba(160, 80, 200, 0.85), rgba(130, 50, 170, 0.9));
    border-color: rgba(200, 120, 255, 0.6);
  }

  /* Chat - Teal */
  body.mobile .chat-btn {
    background: linear-gradient(145deg, rgba(50, 180, 180, 0.85), rgba(30, 150, 150, 0.9));
    border-color: rgba(100, 220, 220, 0.6);
  }

  @media (max-height: 500px) {
    body.mobile .mobile-btn { width: 55px; height: 55px; }
    body.mobile .mobile-btn.primary-action { width: 68px; height: 68px; }
    body.mobile .btn-icon { font-size: 18px; }
  }
</style>

<script>
(function() {
  'use strict';
  const isMobile = document.body.classList.contains('mobile') || (window.hytopia && window.hytopia.isMobile);
  if (!isMobile) return;

  const BUTTONS = {
    'mobile-interact-btn': { input: 'e',  behavior: 'tap',  name: 'Start Challenge' },
    'mobile-jump-btn':     { input: 'sp', behavior: 'tap',  name: 'Jump' },
    'mobile-sprint-btn':   { input: 'sh', behavior: 'hold', name: 'Sprint' },
    'mobile-emote-btn':    { input: 'g',  behavior: 'tap',  name: 'Emote' },
    'mobile-chat-btn':     { input: 'c',  behavior: 'tap',  name: 'Chat' }
  };

  function setupButton(id, cfg) {
    const btn = document.getElementById(id);
    if (!btn) return;
    let pressed = false, touchId = null;

    function press(tid) {
      if (pressed) return;
      pressed = true; touchId = tid;
      btn.classList.add('active');
      if (window.hytopia?.pressInput) window.hytopia.pressInput(cfg.input, true);
      if (cfg.behavior === 'tap') setTimeout(() => release(tid), 150);
    }

    function release(tid) {
      if (!pressed || (tid !== undefined && tid !== touchId)) return;
      pressed = false; touchId = null;
      btn.classList.remove('active');
      if (window.hytopia?.pressInput) window.hytopia.pressInput(cfg.input, false);
    }

    btn.addEventListener('touchstart', e => { e.preventDefault(); press(e.changedTouches[0].identifier); }, { passive: false });
    btn.addEventListener('touchend', e => { e.preventDefault(); for (const t of e.changedTouches) if (t.identifier === touchId) release(t.identifier); }, { passive: false });
    btn.addEventListener('touchcancel', e => { for (const t of e.changedTouches) if (t.identifier === touchId) release(t.identifier); }, { passive: false });
    btn.addEventListener('mousedown', e => { e.preventDefault(); press(-1); });
    btn.addEventListener('mouseup', () => release(-1));
    btn.addEventListener('mouseleave', () => { if (pressed) release(-1); });
    btn.addEventListener('contextmenu', e => e.preventDefault());
  }

  setTimeout(() => { for (const [id, cfg] of Object.entries(BUTTONS)) setupButton(id, cfg); }, 100);
})();
</script>
